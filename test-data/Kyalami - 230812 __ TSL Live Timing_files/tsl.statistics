Statistics=function(){function o(){s(hub),hub=$.connection.liveTiming;hub.on("updateSessionStatistics",f);hub.on("addUpdateFastLapHistory",h);hub.on("deleteFastLapRecord",c);hub.on("addUpdateLeaderHistory",l);hub.on("deleteLeaderRecord",a);hub.on("updateSession",u);hub.on("updateResult",r);hub.server.getSessionStatistics(tsl.liveTiming.eventID).done(function(n){n&&f(n)}),hub.server.getSessionData(tsl.liveTiming.eventID).done(function(n){n&&u(n)})}function s(){hub&&(hub.off("updateSessionStatistics"),hub.off("addUpdateFastLapHistory"),hub.off("deleteFastLapRecord"))}function u(n){n.Units!==null&&r()}function f(n){var t,s,r,f,u,o;if(tsl.liveTiming.viewModel.sessionActualStart(n.SessionActualStart),tsl.liveTiming.viewModel.SessionFinishTime(n.SessionFinishTime),tsl.liveTiming.viewModel.RedFlagsCount(n.RedFlagsCount),tsl.liveTiming.viewModel.SafetyCarsCount(n.SafetyCarsCount),tsl.liveTiming.viewModel.FCYFlagsCount(n.FCYFlagsCount),tsl.liveTiming.viewModel.GreenFlagsCount(n.GreenFlagsCount),tsl.liveTiming.viewModel.TimeUnderGreen(n.TimeUnderGreenFlag),tsl.liveTiming.viewModel.TimeUnderRed(n.TimeUnderRedFlag),tsl.liveTiming.viewModel.TimeUnderSafetyCar(n.TimeUnderYellowFlag),tsl.liveTiming.viewModel.TimeUnderFCY(n.TimeUnderFCYFlag),tsl.liveTiming.viewModel.LapsUnderGreen(n.LapsUnderGreen),tsl.liveTiming.viewModel.LapsUnderRed(n.LapsUnderRed),tsl.liveTiming.viewModel.LapsUnderSC(n.LapsUnderSC),tsl.liveTiming.viewModel.LapsUnderFCY(n.LapsUnderFCY),t=[],n.LeaderHistory!==null){for(i=0;i<n.LeaderHistory.length;i++)r=ko.utils.arrayFirst(tsl.liveTiming.viewModel.rows(),function(t){return t.competitorID()===n.LeaderHistory[i].ID}),r&&(s=new leaderHistoryItem(r,n.LeaderHistory[i]),t.push(s));tsl.liveTiming.setLeaderHistoy("All",t)}if(n.ClassLeaderHistory!==null)for(i=0;i<n.ClassLeaderHistory.length;i++){for(u=n.ClassLeaderHistory[i].History,t=[],j=0;j<u.length;j++)r=ko.utils.arrayFirst(tsl.liveTiming.viewModel.rows(),function(n){return n.competitorID()===u[j].ID}),r&&(f=new leaderHistoryItem(r,u[j]),t.push(f));tsl.liveTiming.setLeaderHistoy(n.ClassLeaderHistory[i].ClassID,t)}if(n.FastLapHistory!==null){for(t=[],i=0;i<n.FastLapHistory.length;i++)r=ko.utils.arrayFirst(tsl.liveTiming.viewModel.rows(),function(t){return t.competitorID()===n.FastLapHistory[i].ID}),r&&(f=new fastLapHistoryItem(r,n.FastLapHistory[i]),t.push(f));tsl.liveTiming.setFastLapHistory("All",t)}if(n.ClassFastLapHistory!==null)for(i=0;i<n.ClassFastLapHistory.length;i++){for(u=n.ClassFastLapHistory[i].History,t=[],j=0;j<u.length;j++)r=ko.utils.arrayFirst(tsl.liveTiming.viewModel.rows(),function(n){return n.competitorID()===u[j].ID}),r&&(f=new fastLapHistoryItem(r,u[j]),t.push(f));tsl.liveTiming.setFastLapHistory(n.ClassFastLapHistory[i].ClassID,t)}if(tsl.liveTiming.viewModel.FlagHistory.removeAll(),n.FlagHistory!==null)for(i=0;i<n.FlagHistory.length;i++)o=new FlagHistoryItem,o.update(n.FlagHistory[i]),tsl.liveTiming.viewModel.FlagHistory.push(o);clearInterval(e),e=setInterval(v,1e3)}function h(n){var r=tsl.liveTiming.getFastLapHistory(n.ClassID),i,f,u;if(r){if(i=t(n.ID,n.TimeOfDay,r),i)i.update(n);else if(u=tsl.liveTiming.getCompetitorByID(n.ID),u)if(i=new fastLapHistoryItem(u,n),r().length===0||r()[0].RawTOD<i.RawTOD)r.unshift(i);else for(f=r().length-1;f>=0;f--)if(i.RawTOD<r()[f].RawTOD){r.splice(f+1,0,i);break}}else u=tsl.liveTiming.getCompetitorByID(n.ID),u&&(i=new fastLapHistoryItem(u,n),tsl.liveTiming.setFastLapHistory(n.ClassID,[i]))}function c(n){var i=tsl.liveTiming.getFastLapHistory(n.ClassID),r;i&&(r=t(n.ID,n.TimeOfDay,i),r&&i.remove(r))}function l(n){var r=tsl.liveTiming.getLeaderHistory(n.ClassID),i,f,u;if(r){if(i=t(n.ID,n.TimeOfDay,r),i)i.update(n);else if(u=tsl.liveTiming.getCompetitorByID(n.ID),u)if(i=new leaderHistoryItem(u,n),r().length===0||r()[0].RawTOD<i.RawTOD)r.unshift(i);else for(f=r().length-1;f>=0;f--)if(i.RawTOD<r()[f].RawTOD){r.splice(f+1,0,i);break}}else u=tsl.liveTiming.getCompetitorByID(n.ID),u&&(i=new leaderHistoryItem(u,n),tsl.liveTiming.setLeaderHistoy(n.ClassID,[i]))}function a(n){var i=tsl.liveTiming.getLeaderHistory(n.ClassID),r;i&&(r=t(n.ID,n.TimeOfDay,i),r&&i.remove(r))}function v(){var u,i,t,r;switch(tsl.liveTiming.viewModel.SessionState()){case"Green":u=tsl.liveTiming.viewModel.TimeUnderGreen().split(":"),i=u[0],t=u[1],r=u[2],i.charAt[0]==="0"&&(i=i.substr(1,i.length-1)),t.charAt[0]==="0"&&(t=t.substr(1,t.length-1)),r.charAt[0]==="0"&&(r=r.substr(1,r.length-1)),tsl.liveTiming.viewModel.TimeUnderGreen(n(i,t,r));break;case"Red":u=tsl.liveTiming.viewModel.TimeUnderRed().split(":"),i=u[0],t=u[1],r=u[2],i.charAt(0)==="0"&&(i=i.substr(1,i.length-1)),t.charAt(0)==="0"&&(t=t.substr(1,t.length-1)),r.charAt(0)==="0"&&(r=r.substr(1,r.length-1)),tsl.liveTiming.viewModel.TimeUnderRed(n(i,t,r));break;case"Yellow":u=tsl.liveTiming.viewModel.TimeUnderSafetyCar().split(":"),i=u[0],t=u[1],t=u[1],r=u[2],i.charAt(0)==="0"&&(i=i.substr(1,i.length-1)),t.charAt(0)==="0"&&(t=t.substr(1,t.length-1)),r.charAt(0)==="0"&&(r=r.substr(1,r.length-1)),tsl.liveTiming.viewModel.TimeUnderSafetyCar(n(i,t,r));break;case"FCY":u=tsl.liveTiming.viewModel.TimeUnderFCY().split(":"),i=u[0],t=u[1],r=u[2],i.charAt(0)==="0"&&(i=i.substr(1,i.length-1)),t.charAt(0)==="0"&&(t=t.substr(1,t.length-1)),r.charAt(0)==="0"&&(r=r.substr(1,r.length-1)),tsl.liveTiming.viewModel.TimeUnderFCY(n(i,t,r))}}function n(n,t,i){return i=Number(i),t=Number(t),n=Number(n),i+1>59?t+1>59?(n++,n<10&&(n="0"+n),n+":00:00"):(n<10&&(n="0"+n),t++,t<10&&(t="0"+t),n+":"+t+":00"):(n<10&&(n="0"+n),t<10&&(t="0"+t),i++,i<10&&(i="0"+i),n+":"+t+":"+i)}function y(){$("#classHistorySelection").on("change",function(){tsl.liveTiming.viewModel.StatsSelectedClass(this.value)})}function t(n,t,i){return ko.utils.arrayFirst(i(),function(i){return i.ID===n&&i.RawTOD===t})}function r(){var t=0,u=tsl.liveTiming.viewModel.TrackLengthMetres();for(i=0;i<tsl.liveTiming.viewModel.rows().length;i++)t+=tsl.liveTiming.viewModel.rows()[i].laps();tsl.liveTiming.viewModel.TotalCompetitorsLaps(t);var n=t*u,r=tsl.liveTiming.viewModel.IsImperial(),f=r?4:3;n=r?tsl.shared.convertMetresToMiles(n):tsl.shared.convertMetresToKilometres(n),n=tsl.shared.truncateDecimal(n,f),tsl.liveTiming.viewModel.TotalDistanceCovered(n+(r?" mi.":" km"))}var e,p;return y(),{UpdateTotalCompetitorsLaps:r,onConnected:o}}()